<!-- Mermaid.js for rendering diagrams -->
<script type="module">
    import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';

    mermaid.initialize({
        startOnLoad: false,
        theme: 'dark',
        themeVariables: {
            primaryColor: '#58a6ff',
            primaryTextColor: '#e6edf3',
            primaryBorderColor: '#30363d',
            lineColor: '#8b949e',
            secondaryColor: '#238636',
            tertiaryColor: '#161b22',
            background: '#0d1117',
            mainBkg: '#161b22',
            nodeBorder: '#30363d',
            clusterBkg: '#21262d',
            clusterBorder: '#30363d',
            titleColor: '#e6edf3',
            edgeLabelBackground: '#161b22'
        },
        securityLevel: 'loose',
        fontFamily: 'ui-sans-serif, system-ui, -apple-system, BlinkMacSystemFont, sans-serif'
    });

    // Wait for DOM to be ready, then find and render mermaid code blocks
    document.addEventListener('DOMContentLoaded', async () => {
        // Find all code blocks with mermaid language and render them
        document.querySelectorAll('pre code.language-mermaid').forEach((codeBlock) => {
            const pre = codeBlock.parentElement;
            const mermaidCode = codeBlock.textContent;

            // Create a new div for the mermaid diagram
            const mermaidDiv = document.createElement('div');
            mermaidDiv.className = 'mermaid';
            mermaidDiv.textContent = mermaidCode;

            // Replace the pre element with the mermaid div
            pre.replaceWith(mermaidDiv);
        });

        // Now run mermaid on the new divs
        await mermaid.run();
    });
</script>